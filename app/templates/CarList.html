{%extends 'base.html'%}
{% load Custom_price %}
{% load static %}
{%block main_block%}

<link rel="stylesheet" href="{% static 'css/carlist.css' %}">


<!-- Hero Section with Background Image -->
<div class="position-relative text-center">
    <img src="{% static 'images/head-image.jpg' %}" alt="Header Image" class="img-fluid w-100"
        style="max-height: 400px; object-fit: cover;">

    <!-- Search & Filter Box Positioned Over Image -->
    <div class="position-absolute top-50 start-50 translate-middle w-50">
        <div class="overlay rounded-4 d-flex justify-content-between align-items-center flex-wrap">
            <!-- Search Box -->
            <form method="GET" action="{% url 'car-list' %}" class="d-flex flex-grow-1 search-container"
                style="margin-left: 45px;">
                <input type="text" class="form-control border border-2" placeholder="Search..." name="q" id="search"
                    value="{{ search }}">
                <button type="submit" class="btn btn-primary ms-2">Search</button>
            </form>


            <!-- Filter Button -->
            <button class="filter-button btn btn-danger ms-2" data-bs-toggle="modal" data-bs-target="#filterModal">
                <i class="fas fa-filter"></i> Filter
            </button>
        </div>
    </div>
</div>

<!-- Filter Modal -->
<div class="modal fade" id="filterModal" tabindex="-1" aria-labelledby="filterModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content border-0 overflow-hidden">
            <!-- Modal Header with Gradient Background -->
            <div class="modal-header bg-gradient bg-dark text-white py-4">
                <div class="w-100 text-center position-relative">
                    <h3 class="modal-title fw-bold mb-0" id="filterModalLabel">
                        <i class="fas fa-sliders-h me-2"></i> Refine Your Search
                    </h3>
                </div>
            </div>

            <!-- Modal Body -->
            <div class="modal-body p-0">
                <form method="GET" action="{% url 'car-list' %}">
                    <div class="p-4">
                        <!-- Price Range - Card Style -->
                        <div class="card border border-2 shadow-sm mb-4 overflow-hidden">
                            <div class="card-header bg-light">
                                <h5 class="mb-0 fw-semibold">
                                    <i class="fas fa-tag me-2 text-primary"></i> Price Range
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="d-flex justify-content-between mb-3 ">
                                    <span id="minPriceLabel"
                                        class="badge bg-primary bg-opacity-10 text-primary fs-6 px-3 py-2">₹0</span>
                                    <span id="maxPriceLabel"
                                        class="badge bg-primary bg-opacity-10 text-primary fs-6 px-3 py-2">₹2Cr</span>
                                </div>
                                <div class="range-slider-container position-relative py-3">
                                    <div class="range-slider-track bg-light rounded-pill"></div>
                                    <input type="range" class="form-range range-slider-thumb" id="minPrice"
                                        name="min_price" min="0" max="20000000" step="1000" value="0">
                                    <input type="range" class="form-range range-slider-thumb" id="maxPrice"
                                        name="max_price" min="0" max="20000000" step="1000" value="20000000">
                                </div>
                            </div>
                        </div>

                        <!-- Car Type - Card Style -->
                        <div class="card border border-2 shadow-sm mb-4 overflow-hidden ">
                            <div class="card-header bg-light">
                                <h5 class="mb-0 fw-semibold">
                                    <i class="fas fa-car me-2 text-success"></i> Car Type
                                </h5>
                            </div>
                            <div class="card-body ">
                                <select class="form-select form-select-lg border-0 shadow-none" id="carType"
                                    name="car_type">
                                    <option value="">All Types</option>
                                    {% for type in car_types %}
                                    <option value="{{ type.name }}">{{ type.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>

                        <!-- Transmission & Fuel Type - Side by Side Cards -->
                        <div class="row g-4">
                            <div class="col-md-6">
                                <div class="card border border-2 shadow-sm h-100">
                                    <div class="card-header bg-light">
                                        <h5 class="mb-0 fw-semibold">
                                            <i class="fas fa-cog me-2 text-warning"></i> Transmission
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <select class="form-select form-select-lg border-0 shadow-none"
                                            id="transmissionType" name="transmission">
                                            <option value="">All Options</option>
                                            <option value="Automatic">Automatic</option>
                                            <option value="Manual">Manual</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card border border-2 shadow-sm h-100">
                                    <div class="card-header bg-light">
                                        <h5 class="mb-0 fw-semibold">
                                            <i class="fas fa-gas-pump me-2 text-danger"></i> Fuel Type
                                        </h5>
                                    </div>
                                    <div class="card-body">
                                        <select class="form-select form-select-lg border-0 shadow-none" id="fuelType"
                                            name="fuel_type">
                                            <option value="">All Options</option>
                                            <option value="Petrol">Petrol</option>
                                            <option value="Diesel">Diesel</option>
                                            <option value="Electric">Electric</option>
                                            <option value="Hybrid">Hybrid</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Modal Footer with Sticky Apply Button -->
                    <div class="modal-footer bg-light sticky-bottom p-3 border-top">
                        <button type="button" class="btn btn-outline-secondary rounded-pill px-4"
                            data-bs-dismiss="modal">
                            <i class="fas fa-times me-2"></i> Cancel
                        </button>
                        <button type="submit" class="btn btn-primary rounded-pill px-4 shadow-sm">
                            <i class="fas fa-check-circle me-2"></i> Apply Filters
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>



<!-- cars-------------------------------------- -->
<div class="container mt-5">
    <div class="row">
        {% for c in car %}
        <div class="col-12 col-md-4">
            <div class="card position-relative mb-5">
                {% if not c.is_available %}
                <span class="badge bg-danger position-absolute top-0 end-0 m-2" style="height: 30px; width: 90px;">
                    <p class="mt-1">Sold Out</p>
                </span>
                {% endif %}
                <img src="{{ c.image.url }}" class="card-img-top img-fluid img-cover" alt="{{ c.name }}">
                <div class="card-body">
                    <div class="row">
                        <div class="col-12">
                            <h4 class="card-title mb-4">₹ {{ c.price|format_price }}</h4>
                        </div>
                    </div>
                    <div class="row">
                        <!-- Left Side (Existing Items) -->
                        <div class="col-6 text-start pe-3" style="border-right: 2px solid rgb(201, 201, 201);">   
                            <p><strong>Name: </strong>{{ c.name }}</p>
                            <p><strong>Owner Count: </strong>{{ c.owner_count }}</p>
                            <p>Posted On: {{ c.created_date }}</p>
                        </div>
                    
                        <!-- Right Side (New Items) -->
                        <div class="col-6 text-start ps-3">
                            <p><strong>Year:</strong> {{ c.year }}</p>
                            <p><strong>KM Run:</strong> {{ c.total_km_run }} km</p>
                            <p><strong>Fuel Type:</strong> {{ c.fuel_type }}</p>
                        </div>
                    </div>
                    <a href="#" class="btn btn-primary mt-2">Details</a>
                    
                </div>
            </div>
        </div>
        {% endfor %}

    </div>
</div>

<script>
    // Enhanced Price Range Slider with Better Formatting
    function formatPrice(value) {
        value = parseInt(value);
        if (value >= 10000000) {
            return "₹" + (value / 10000000).toFixed(1) + " Cr";
        } else if (value >= 100000) {
            return "₹" + (value / 100000).toFixed(0) + " L";
        }
        return "₹" + new Intl.NumberFormat('en-IN').format(value);
    }

    const minPrice = document.getElementById("minPrice");
    const maxPrice = document.getElementById("maxPrice");
    const minPriceLabel = document.getElementById("minPriceLabel");
    const maxPriceLabel = document.getElementById("maxPriceLabel");

    // Initialize labels with proper formatting
    minPriceLabel.textContent = formatPrice(minPrice.value);
    maxPriceLabel.textContent = formatPrice(maxPrice.value);

    // Update prices with smooth transitions
    function updatePrices() {
        // Ensure min doesn't exceed max
        if (parseInt(minPrice.value) > parseInt(maxPrice.value)) {
            minPrice.value = maxPrice.value;
        }

        // Ensure max doesn't go below min
        if (parseInt(maxPrice.value) < parseInt(minPrice.value)) {
            maxPrice.value = minPrice.value;
        }

        // Update labels with formatted values
        minPriceLabel.textContent = formatPrice(minPrice.value);
        maxPriceLabel.textContent = formatPrice(maxPrice.value);

        // Visual feedback
        minPriceLabel.classList.add('animate__animated', 'animate__pulse');
        maxPriceLabel.classList.add('animate__animated', 'animate__pulse');

        setTimeout(() => {
            minPriceLabel.classList.remove('animate__animated', 'animate__pulse');
            maxPriceLabel.classList.remove('animate__animated', 'animate__pulse');
        }, 300);
    }

    minPrice.addEventListener("input", updatePrices);
    maxPrice.addEventListener("input", updatePrices);

    // Initialize modal show/hide animations
    const filterModal = document.getElementById('filterModal');
    filterModal.addEventListener('show.bs.modal', function () {
        this.querySelector('.modal-content').classList.add('animate__animated', 'animate__fadeInUp');
    });

    filterModal.addEventListener('hidden.bs.modal', function () {
        this.querySelector('.modal-content').classList.remove('animate__animated', 'animate__fadeInUp');
    });
</script>

{%endblock%}